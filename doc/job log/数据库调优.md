### 数据库调优

数据库调优主要是在数据落盘到MySQL的时候, 对写入数据时候做的优化.

这里ADS层产生的报表RDD, 经过切分, 利用RDD的foreachPartition优化写入数据库的性能.(其中还可以用
Spark的监听器来对数据写入流程做一个实时的监控)

对写入数据库性能优化的一个大的思路是重写了Spark源码中的JdbcUtils.savePartition()方法, 

参照这个方法, 一个大的思路是禁止数据库事务的自动提交, 改为手动去控制数据的一个提交时机, 

设置一个阈值, 在分区中拼接SQL, 当SQL的长度大于这个阈值execute, 
这里阈值是通过max_allow_packet(数据库server一次性接收数据包的大小来计算的)

然后execute到一定程度, commit, 这个地方我们是根据剩余缓冲页的数量来决定是否commit的


### 对待服务器重启的异常情况

如果数据库压力过大宕机, 进行服务器重启, 这时要保证数据库重启之后要能重新连接

